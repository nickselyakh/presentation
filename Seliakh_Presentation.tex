\documentclass[notheorems]{beamer}
\usepackage[cp1251]{inputenc}
\usepackage{SlideStyle}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{amsmath}
\usepackage{listings}
\usepackage[ruled,vlined,linesnumbered]{algorithm2e}

\titlegraphic{\vspace*{-7cm}
    \parbox[c]{3cm}{\includegraphics[height=.7cm]{bsulogo}}
    \hspace*{1cm}%
    \parbox[c]{2cm}{\includegraphics[height=1.5cm]{FPMIlogo}}
    \hspace*{1cm}%
    \parbox[c]{3cm}{\includegraphics[height=.7cm]{MOUlogo}}
    \vspace*{3cm}
}

\title{СИНТЕЗ ОПТИМАЛЬНЫХ СИСТЕМ И УПРАВЛЕНИЙ ПО ПРОГНОЗИРУЮЩЕЙ МОДЕЛИ НА ОСНОВЕ МЕТОДОВ ПАРАМЕТРИЧЕСКОГО ЛИНЕЙНОГО ПРОГРАММИРОВАНИЯ}


\author[Н. С. Селях]{Никита Е. Селях}

\institute[ФПМИ, БГУ]{}


\date[\copyright 2020-2020]{}

\begin{document}
\maketitle



%-----------------------------------------------------------------------

\begin{frame}{Классический подход к построению оптимальных обратных связей}
    Классический подход к построению оптимальной обратной связи продемонстрируем на примере следующей задачи:
    \begin{block}{Задача}
        \begin{equation} \label{1problem}
            J(u) = \varphi(x(t_f))\to \min,
            \end{equation}
        \begin{equation} \label{2problem}
            \dot{x}=f(x,u,t),\ x(t_0)=x_0
             \end{equation}
        \begin{equation} \label{3problem}
              x(t)\in X\in\mathbb{R}^n
             \end{equation}
        \begin{equation} \label{4problem}
               u(t)\in U\in\mathbb{R}^r,\  t\in [t_0, t_f]
             \end{equation}
    \end{block}
\end{frame}
%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Классический подход к построению оптимальных обратных связей}
    Погрузим задачу (\ref{1problem}) -- (\ref{4problem}) в следующее семейство задач:
    \begin{block}{Семейство задач}
    \begin{equation} \label{5problem}
        \varphi(x(t_f))\to \min,
        \end{equation}
    $$
        \dot{x}=f(x,u,t),\ x(\tau)=z,
        $$
    $$
          x(t)\in X, \ \ u(t)\in U,\  t\in [\tau, t_f].
      $$
    \end{block}
    
    Пусть $u^0(t|\tau,z),\ t\in T_\tau$, --- оптимальная программа задачи (\ref{5problem}) для позиции $(\tau,z)$; $X_\tau$ --- множество состояний $z$ таких, что для позиции $(\tau,z)$ существуют программные решения задачи (\ref{5problem}).
    
    Функция
\begin{equation} \label{6problem}
    u^0(\tau,z) = u^0(t|\tau,z), \ z\in X_{\tau}, \tau\in T,
     \end{equation}
     --- оптимальная обратная связь.

Построение (\ref{6problem}) --- синтез оптимальной системы управления.

\end{frame}
%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического программирования в задачах синтеза}
    Рассмотрим задачу оптимального управления линейной системой со скалярным управлением

    $$
        \dot{x} = Ax + bu,
    $$
    cо следующим критерием качества
\begin{equation*}
    J(u) = \int_0^{t_f}|u(t)|dt \to \min,
\end{equation*}
при условиях
$$
    x(0) = x_0,\ x(t_f) = 0, \ \ |u(t)|\le L,
$$
где $L>0$ --- амплитуда управления.
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического программирования в задачах синтеза}
    Семейство, в которое погружается задача для определения обратной связи, имеет вид
    \begin{block}{}
        \begin{equation}\label{3-2-1}
            J(u) = \int_{\tau}^{t_f}|u(t)|dt \to \min,
        \end{equation}
        $$
            \dot{x} = Ax + bu, \ x(\tau) = z,
        $$
        $$
            x(t_f) = 0, \ \ |u(t)|\le L, t\in [\tau, t_f].
        $$
    \end{block}
        Здесь $z$ выступает в качестве параметра.    
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического программирования в задачах синтеза}
    Чтобы избавиться от модуля в подынтегральном выражении представим $u(t)$  в виде:
    $$
        u(t) = u_1(t) - u_2(t),
    $$
    тогда $|u(t)| = u_1(t) + u_2(t)$, где $0 \le u_1(t) \le 1, \ 0 \le u_2(t) \le 1.$
    
    Таким образом, в классе дискретных оптимальных управлений получаем криерий качества:
    $$
        \int_{\tau}^{t_f}u_1(t) + u_2(t)dt = \sum_{s \in T_h(\tau)}h(u_1(s) + u_2(s)) \to \min.
    $$ 
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического программирования в задачах синтеза}
    Тогда в результате проделанных преобразований привели задачу (\ref{3-2-1}) к следующему виду:
    \begin{block}{}
    \begin{equation*} \label{3-2-2}
        \begin{aligned}
            & \sum_{s \in T_h(\tau)}h(u_1(s) + u_2(s)) \to \min,\\
            & \dot{x} = Ax + bu_1 - bu_2,   \\
            &  x(\tau) = z, \ \ x(t_f) = 0, \\
            & 0\le u_1(s)\le L, \ 0\le u_1(s)\le L, \  s\in T_h(\tau).
        \end{aligned}
    \end{equation*}
\end{block}
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического программирования в задачах синтеза}
    Запишем по формуле Коши терминальное состояние:
    \begin{equation*}
        x(t_f) = F(t_f, t_0)x_0 + \int_{t_0}^{t_f}F(t_f, \theta)b(u_1(\theta) - u_2(\theta))d\theta.
    \end{equation*}
    В силу дискретности управляющего воздействия, интеграл на промежутке $T = [t_0, t_f]$ представим в виде суммы интегралов на промежутках $[s,s+h],\ s \in T_h$.
    
    Теперь терминальные ограничения:
    \begin{equation*}
       x(t_f) = F(t_f, t_0)x_0 +  \sum_{s \in T_h}\int_{s}^{s+h} F(t_f, \theta)b \ d\theta (u_1(s) - u_2(s)) = 0.
    \end{equation*}
    
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического программирования в задачах синтеза}
    Введем обозначение:
    \begin{equation*}
        d_h(s) = \int_{s}^{s+h} F(t_f, \theta)b \ d\theta,
    \end{equation*}
    \begin{equation*}
        G(t_0) = - F(t_f, t_0), \ \ 
        G(\tau) = - F(t_f, \tau).
    \end{equation*}
    
    Задача для позиции $(\tau,z)$:
    \begin{equation*}
        \begin{aligned}
            & \sum_{s \in T_h(\tau)} h(u_1(s) + u_2(s)) \to \min,\\
            & \sum_{s \in T_h(\tau)} d_h(s)(u_1(s) - u_2(s)) = G(\tau)z, \\
            & 0 \le u_i(s) \le L, \ i = 1, 2, \ s \in T_h(\tau).\\
        \end{aligned}
    \end{equation*}
    Полученные задачи  --- функциональная форма задачи оптимального управления.
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического программирования в задачах синтеза}
    Соответствующая задача, как задача многопараметрического программирования (mp-LP):
    \begin{equation*}
        \begin{aligned}
            & {\bf 1}^T U \to \min,\\
            & DU = G(\tau)z, \\
            & 0 \le U \le L{\bf 1},\\
        \end{aligned}
    \end{equation*}
    где 
    $$  
        D = [d_h(\tau)\ -d_h(\tau)\ \ldots \ d_h(t_f-h)\ -d_h(t_f-h)],
         $$
    $$ 
        U = [u_1(\tau)\ u_2(\tau)\ \ldots \ u_1(t_f-h)\ u_2(t_f-h)]^T,
         $$
    ${\bf 1}$ --- вектор из единиц соответствующей размерности.
       
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Multi-Parametric Toolbox}
    Multi-Parametric Toolbox (или MPT) --- это набор инструментов и функций на основе Matlab с открытым исходным кодом для параметрической оптимизации и вычислительной геометрии.
    Инструментарий предлагает широкий спектр алгоритмов, скомпилированных в удобном и доступном для пользователя формате.
    Полученные в результате законы оптимального управления могут быть встроены в приложения в виде кода на C или развернуты на целевых платформах с использованием Real Time Workshop.
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Multi-Parametric Toolbox}
    Содержание MPT для задач управления можно разделить на четыре модуля:
    \begin{itemize}
        \item Моделирование динамических систем.
        \item Построение MPC-регуляторов для линейных систем на основе явных схем (на основе многопараметрического программирования).
        \item Анализ обратной связи, полученной МРС-регулятором.
        \item Развертывание регуляторов MPC на аппаратном уровне.
    \end{itemize}
\end{frame}

%--------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического программирования в задаче синтеза оптимальной линейной системы}
    В качестве примера синтеза рассмотрим задачу оптимизации колебательной системы второго порядка, критерием качества в которой является минимизация полного импульса управляющего воздействия:
    $$
        J(u) = \int_0^{t_f}|u(t)|dt \to \min,
        $$

            $$ \dot{x_1} = x_2,\                                         $$
            $$ \dot{x_2} = -x_1 + u,$$

\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
\begin{frame}{Применение параметрического программирования в задаче синтеза оптимальной линейной системы}
    \begin{figure}[h!]
        \centering
        \begin{subfigure}[b]{0.4\linewidth}
        \includegraphics[width=0.7\textwidth]{figure1.eps}
          \caption{N = 20, $\tau = 0$}
        \end{subfigure}
        \begin{subfigure}[b]{0.4\linewidth}
            \includegraphics[width=0.7\textwidth]{figure5.eps}
          \caption{N = 15, $\tau = 2.5$}
        \end{subfigure}
        \begin{subfigure}[b]{0.4\linewidth}
        \includegraphics[width=0.7\textwidth]{figure10.eps}
          \caption{N = 10, $\tau = 5$}
        \end{subfigure}
        \begin{subfigure}[b]{0.4\linewidth}
            \includegraphics[width=0.7\textwidth]{figure20.eps}
          \caption{N = 1, $\tau = 9.5$}
        \end{subfigure}
        \label{4-img-1}
    \end{figure}
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
\begin{frame}{Применение параметрического программирования в задаче синтеза оптимальной линейной системы}
    \begin{figure}[h!]
        \centering
        \begin{subfigure}[b]{0.48\linewidth}
            \includegraphics[width=1\textwidth]{graphics-42.eps}
          \caption{Траектории и управление для $x_0 = (0, 5)$}
        \end{subfigure}
        \begin{subfigure}[b]{0.48\linewidth}
            \includegraphics[width=1\textwidth]{x1x2.eps}
          \caption{Фазовые траектории для $x_0 = (0, 5)$}
        \end{subfigure}
        \label{4-img1-1}
    \end{figure}
\end{frame}

%-----------------------------------------------------------------------
% -----------------------------------------------------------------------
\begin{frame}{Применение параметрического программирования в задаче синтеза оптимальной линейной системы}
    \begin{block}{}
        u0 = 
          linprog([ch', ch'],[],[],[dh,-dh],
            g0,zeros(2*N,1),L*ones(2*N,1)),
    \end{block}
\begin{figure}[h!]
    \centering
    \begin{subfigure}[b]{0.4\linewidth}
        \includegraphics[width=\linewidth]{primer2-u.eps}
        \caption{Оптимальная программа}
      \end{subfigure}
    \begin{subfigure}[b]{0.4\linewidth}
      \includegraphics[width=\linewidth]{picture2-x.eps}
      \caption{Фазовый портрет оптимальной траектории}
    \end{subfigure}
    \label{picture-primer}
  \end{figure}   
\newpage
\end{frame}

% -----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического программирования в MPC}
    Рассмотрим дискретную линейную систему управления:
\begin{equation}\label{sys1}
     x (t + 1) = \begin{bmatrix}
            1 & 1\\
            0 & 1
        \end{bmatrix}x(t) + \begin{bmatrix}
            1\\
            0.5
        \end{bmatrix}u(t),
\end{equation}
c ограничениями $-5 \le x(t) \le 5$ и $-1 \le u(t) \le 1$, $t= 0,1, \ldots$.
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического программирования в MPC}
    \textbf{Матрицы:}

        A = [ 1, 1; 0,  1];\\
        B = [ 1; 0.5]; \\
        
    \textbf{Задаем линейную модель с дискретным временем:}\\

    sys = ss(A,B,[],[],1);
    model = LTISystem(sys); \\

    \textbf{Ограничения на управления и состояния:} \\
    model.x.min = [-5; -5];
model.x.max = [5; 5];
model.y.min = [-10; -10];
model.y.max = [10; 10];
model.u.min = -1;
model.u.max = 1;

\textbf{Параметры критерия качества:}\\
R = 1;
model.u.penalty = QuadFunction(R);
model.x.penalty = QuadFunction(eye(2));

\textbf{Терминальные значения:}\\
P = model.LQRPenalty;
Tset = model.LQRSet;

\textbf{Наконец, формулируем задачу MPC:}\\


ctrl = MPCController(model,7);


\end{frame}

%------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического программирования в MPC}
    \begin{figure}[h!]
        \centering
        \begin{subfigure}[b]{0.4\linewidth}
          \includegraphics[width=\linewidth]{pctr-u.eps}
          \caption{Управляющее воздействие}
        \end{subfigure}
        \begin{subfigure}[b]{0.4\linewidth}
          \includegraphics[width=\linewidth]{pctr-x.eps}
          \caption{Траектории X}
        \end{subfigure}
        \caption{Результаты реализации для $x = (3, 1)$}
        \label{fig:4-1-res}
      \end{figure}
\end{frame}


%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического программирования в MPC}
    \begin{figure}[h!]
        \centering
        \includegraphics[width=0.7\linewidth]{pctr-expl.eps}
        \caption{Критические области и траектории замкнутой системы  для нескольких начальных значений}
        \label{fig:4-1-res2}
      \end{figure}
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Заключение}

\centering \large \emph{Спасибо за внимание!}

\end{frame}

%--------------------------------------------------------------------------

\end{document} 