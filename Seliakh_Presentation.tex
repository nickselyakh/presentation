\documentclass[notheorems]{beamer}
\usepackage[cp1251]{inputenc}
\usepackage{SlideStyle}
\usepackage{graphicx}
%\usepackage{subcaption}
\usepackage{amsmath}
%\usepackage{listings}
%\usepackage[ruled,vlined,linesnumbered]{algorithm2e}

\titlegraphic{\vspace*{-8cm}
    \parbox[c]{3cm}{\includegraphics[height=.7cm]{bsulogo}}
    \hspace*{1cm}%
    \parbox[c]{2cm}{\includegraphics[height=1.5cm]{FPMIlogo}}
    \hspace*{1cm}%
    \parbox[c]{3cm}{\includegraphics[height=.7cm]{MOUlogo}}
    \vspace*{4cm}
}

\title[Синтез оптимальных систем на основе mp-LP]{СИНТЕЗ ОПТИМАЛЬНЫХ СИСТЕМ И УПРАВЛЕНИЙ ПО ПРОГНОЗИРУЮЩЕЙ МОДЕЛИ НА ОСНОВЕ МЕТОДОВ ПАРАМЕТРИЧЕСКОГО ЛИНЕЙНОГО ПРОГРАММИРОВАНИЯ}


\author[Н. С. Селях]{Никита Е. Селях}

\institute[ФПМИ, БГУ]{Кафедра методов оптимального управления}


\date[\copyright 2020]{\footnotesize \structure{Научный руководитель: Н.М.Дмитрук}}

\begin{document}
\maketitle


\begin{frame}{Цели и задачи работы}

\begin{itemize}\itemsep = 3mm
\item Предложить методы синтеза оптимальных обратных связей в линейной задаче оптимального управления на основе идей параметрического программирования, по аналогии с подходами, использующимися в явных схемах управления по прогнозирующей модели.

\item Применить набор инструментов и функций на основе Matlab для параметрической оптимизации и вычислительной геометрии (Multi-Paramteric Toolbox).
\end{itemize}

\end{frame}

%-----------------------------------------------------------------------

\begin{frame}{Классическое определение синтеза \\ оптимальных обратных связей}

\begin{itemize}\itemsep = 3mm
\item     Классический подход к построению оптимальной обратной связи продемонстрируем на примере следующей задачи:


\end{itemize}

    \begin{block}{Задача оптимального управления}
        \begin{equation} \label{1problem}
            J(u) = \varphi(x(t_f))\to \min,
            \end{equation}
        \begin{equation} \label{2problem}
            \dot{x}=f(x,u,t),\ x(t_0)=x_0
             \end{equation}
        \begin{equation} \label{3problem}
              x(t)\in X\in\mathbb{R}^n
             \end{equation}
        \begin{equation} \label{4problem}
               u(t)\in U\in\mathbb{R}^r,\  t\in [t_0, t_f]
             \end{equation}
    \end{block}
\small $x = x(t)\in \R^n$ --- состояние

$u = u(t)\in \R^r$ --- управление

\end{frame}


%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Классическое определение синтеза \\ оптимальных обратных связей}

\begin{itemize}\itemsep = 2mm
\item    Погрузим задачу (\ref{1problem}) -- (\ref{4problem}) в семейство, зависящее от позиции $\alert{(\tau,z)}$:
    \begin{block}{Семейство задач}
    \begin{equation} \label{5problem}
        \varphi(x(t_f))\to \min
        \end{equation}
    $$
        \dot{x}=f(x,u,t),\ x(\alert{\tau})=\alert{z}
        $$
    $$
          x(t)\in X, \ \ u(t)\in U,\  t\in [\alert{\tau}, t_f]
      $$
    \end{block}

 {\small $u^0(t|\tau,z),\ t\in T_\tau$, --- оптимальная программа (\ref{5problem})

 $X_\tau$ --- множество состояний $z$, для которых  (\ref{5problem}) имеет решение}

\item    \alert{Оптимальная обратная связь}
\begin{equation} \label{6problem}
    u^0(\tau,z) = u^0(t|\tau,z), \ z\in X_{\tau}, \tau\in T
     \end{equation}

\item Построение (\ref{6problem}) --- \alert{синтез} оптимальной системы управления

\end{itemize}

\end{frame}

%-----------------------------------------------------------------------
% -----------------------------------------------------------------------
\begin{frame}{Управление по прогнозирующей модели \\ Model Predictive Control (MPC)}

\begin{itemize}

\item Линейная стационарная система управления
\begin{equation}\label{sys}
    x(t) = Ax(t) + Bu(t), \  x(0) = x_0, \ \ t = 0,1, \ldots
    \end{equation}


\item На состояния и управления наложены ограничения
\begin{equation}\label{constr}
    C_{x}x(t) \le d_x, \  C_{u}u(t) \le d_u,  \ \  t = 0,1, \ldots
    \end{equation}
 
\item Цель управления системой (\ref{sys}) --- \alert{стабилизация}, т.е. построение обратной связи $u(x)$, при которой замкнутая система
\begin{equation}\label{1-5-3}
    x(t+1) = g(x(t)) = Ax(t) + Bu(x(t))
    \end{equation}
будет асимптотически устойчива в заданном положении равновесия $x \equiv 0$, $u \equiv 0$ 

\item При этом переходный процесс не нарушает ограничения (\ref{constr})

 

\end{itemize}



\end{frame}

%-----------------------------------------------------------------------
% -----------------------------------------------------------------------
\begin{frame}{Алгоритм MPC}

    \begin{itemize}
        \item Базовый алгоритм MPC состоит в следующем:

    \begin{enumerate}\itemsep = 3mm
        \item измерить состояние $x(t) \in X$ системы (\ref{sys});
        \item решить прогнозирующую задачу с начальным условием $x(0|t) = x(t)$, получить ее решение $u^0(\cdot|t)$;
        \item подать на вход системы  (\ref{sys}) управляющее воздействие:
        \begin{block}{}
            \begin{equation}\label{1-5-6}
               u_{MPC}(t) := u^0(0|t).
           \end{equation}
        \end{block}
    \end{enumerate}


% \item $N< +\infty$ --- горизонт прогнозирования

\end{itemize}



\end{frame}

%-----------------------------------------------------------------------
% -----------------------------------------------------------------------
\begin{frame}{Прогнозирующая задача для МРС}

\begin{itemize}
\item Прогнозирующая задача строится для текущего момента времени $\alert t$ и текущего измеренного состояния $\alert{x(t)}$
    
\item Переменными прогнозирующей модели являются состояние $x(k|\ t)$, k = $\overline{t, t+N}$, и управления $u(k|\ t)$, $k = \overline{t, t+N-1}$

\end{itemize}

\begin{block}{}
\begin{equation} \label{yav-1}
    J(\alert{x(t)}) = \min_{u(\cdot | t)} \sum_{k=t}^{t+N-1} L(x(k|\ t), u(k|\ t)) + F(x(t+N|\ t))
\end{equation}
\begin{equation*}
            \begin{aligned}
                & x(k+1 |\ t) = Ax(k |\ t) + Bu(k|\ t), \  
                x(t|\ t) = \alert{x(t)} \\
                & C_{x}x(k|\ t) \le d_x, \  C_{u}u(k|\ t) \le d_u,  \ \  k = \overline{t, t+N-1} \\
                & C_f x(t + N |\ t) \le d_f \\
            \end{aligned}
        \end{equation*}
    \end{block}

\small 

        $ L(x, u) = x^TQx + u^TRu $ --- квадратичная функция стоимости этапа
        
        $ F(x) = x^TPx$ --- терминальная стоимость 

$C_f, d_f$ задают ограничения на  терминальное состояние

\end{frame}

%-----------------------------------------------------------------------
% -----------------------------------------------------------------------

\begin{frame}{Явный МРС}

\begin{itemize}
\item Прогнозирующая задача сводится к задаче квадратичного программирования, зависящей от параметра $\alert{x = x(t)}$:

\end{itemize}

\begin{block}{}
\begin{equation} \label{yav-1}
       J(\alert{x}) = \min_{z} \frac{1}{2}z^THz + \frac{1}{2}{\alert{x^T}}\tilde{Y}{\alert{x}}
    \end{equation}
\begin{equation} \label{yav-2}
       Gz \le W + S{\alert{x}}
       \end{equation}
\end{block}

\footnotesize $H = 2(\tilde{R} + \Gamma^T\tilde{Q}\Gamma)$, $\tilde{Y} = Y - FH^{-1}F^T$

$G = \diag(C_x,\dots, C_x),\ W = [d_x,\dots,d_x]^T$, $S = \diag(C_x,\dots,C_x)\Omega + GH^{-1}F^T$

$Y = 2(Q + \Omega^T \tilde{Q}\Omega)$, $F = 2\Omega^T\tilde{Q}\Gamma$, $\tilde{Q} = \diag(Q, \dots, Q, P)$

$$
\Omega = \begin{bmatrix}
A\\
A^2\\
\vdots\\
A^N
\end{bmatrix}, \
\Gamma = \begin{bmatrix}
    B & 0 & \vdots & 0 \\
    AB & B & \vdots & 0 \\
    \cdots & \cdots & \vdots & \cdots &\\
    A^{N-1}B & A^{N-1}B & \vdots & B
\end{bmatrix}
$$


\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Многопараметрическое \\ программирование}
    \begin{block}{Многопараметрическая задача линейного программирования}
        \begin{equation}\label{1multy}
            \begin{split}
                & J^0(x) = \min_z J(z,x) = c'z\\
                % \st
                 & Gz \leq W + Sx
            \end{split}
        \end{equation}
    \end{block}
    \small $z \in \mathbb{R}^s$ --- переменные оптимизации 
    
    $x \in \mathbb{R}^{n}$ --- вектор параметров  
    
    $c \in \mathbb{R}^{s},\ G \in \mathbb{R}^{m \times s},\ W \in \mathbb{R}^{m}$, и $S \in \mathbb{R}^{m \times n}$,\

$K = \{ x \in \mathbb{R}^{n} : Tx \leq Z \}$ ---  множество возможных значений параметров

\begin{itemize}\itemsep = 2mm
    \item $\alert{K^*} \subseteq K$ --- множество параметров $x \in K$, при которых задача (\ref{1multy}) допустима
        
    \item $J^0(x)$ --- оптимальное значение задачи (\ref{1multy}) при заданном $x\in K^*$

\item $Z^0(x)= \{ z  \ | \ c'z = J^0(x) \}$ --- множество оптимальных  планов задачи

\end{itemize}
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Cвойства решений задачи\\ многопараметрического линейного программирования}
    \begin{theorem}\label{8theorem}
\begin{itemize}\itemsep = 2mm
\item  Функция $J^0(x)$, $x\in K^*$, является выпуклой и кусочно-аффинной

\item   Если для каждого $x\in K^*$ оптимальное решение $z^0 (x)$ единственно, то функция $z^0(x)$, $x\in K^*$, является непрерывной и кусочно-аффинной
     
\item В противном случае (в случае неединственного решения) всегда можно определить непрерывную и кусочно-аффинную функцию решения $z^0 (x) \in Z^0 (x)$, $x\in K^*$
    
\end{itemize}
    \end{theorem}

\begin{itemize}\itemsep = 2mm
\item  Многогранник ${K^*}$ единственным образом разбивается на области аффинности функции $z^0(x)$

\item  Эти области называются \alert{критическими областями}

\end{itemize}

\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Multi-Parametric Toolbox}
\begin{itemize}\itemsep = 3mm
\item Для построения критических областей и законов обратной связи используется  Multi-Parametric Toolbox (или \textbf{MPT})
        
\item MPT --- это набор инструментов и функций на основе Matlab с открытым исходным кодом для параметрической оптимизации и вычислительной геометрии

\item МРТ предлагает широкий спектр алгоритмов, скомпилированных в удобном и доступном для пользователя формате
    
\item Полученные в результате законы оптимального управления могут быть встроены в приложения в виде кода на C или развернуты на целевых платформах с использованием Real Time Workshop
    \end{itemize}
\end{frame}



%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического \\ программирования в MPC}

\begin{itemize}
\item {Дискретная линейная система управления}
        \begin{equation}\label{sys1}
            x (t + 1) = \begin{bmatrix}
                1 & 1\\
                0 & 1
            \end{bmatrix}x(t) + \begin{bmatrix}
                1\\
                0.5
            \end{bmatrix}u(t),
        \end{equation}
       
\item Ограничения 
$$
    -5 \le x(t) \le 5; \ -1 \le u(t) \le 1, \ t= 0,1, \ldots
    $$
    
\item Критерий качества для прогнозирующей задачи
$$
    J^{*}_z(x(0)) = \min_z J(z,x) = \frac{1}{2}z^THz
$$

\end{itemize}
\end{frame}



%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического \\ программирования в MPC}
    \begin{itemize}
        \item Критические области и траектории замкнутой системы  для нескольких начальных значений
    \end{itemize}

\centering        

\includegraphics[width=0.7\linewidth]{pctr-expl.eps}

\end{frame}

%------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического \\ программирования в MPC}
    \begin{itemize}
        \item Результаты реализации для $x = (3, 1)$
    \end{itemize}

          \includegraphics[width=0.48\linewidth]{pctr-u.eps}
          \includegraphics[width=0.48\linewidth]{pctr-x.eps}
\end{frame}



%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
\begin{frame}{Применение параметрического \\ программирования в задачах синтеза}

\begin{itemize}\itemsep = 3mm
\item      Рассмотрим задачу оптимального управления линейной системой со скалярным управлением
    \begin{equation}
        \dot{x} = Ax + bu
    \end{equation}
\item  c критерием качества
\begin{equation}
    J(u) = \int_0^{t_f}|u(t)|dt \to \min
\end{equation}
\item при условиях
\begin{equation}
    x(0) = x_0,\ x(t_f) = 0, \ \ |u(t)|\le L
\end{equation}
{\small $L>0$ --- амплитуда управления}

\end{itemize}
\end{frame}



%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического \\ программирования в задачах синтеза}

\begin{itemize}\itemsep = 3mm
\item
    Семейство, в которое погружается задача для определения обратной связи:
    \begin{block}{}
        \begin{equation}\label{3-2-1}
            J(u) = \int_{\tau}^{t_f}|u(t)|dt \to \min
        \end{equation}
        $$
            \dot{x} = Ax + bu, \ x(\tau) = \alert{z}
        $$
        $$
            x(t_f) = 0, \ \ |u(t)|\le L, t\in [\tau, t_f]
        $$
    \end{block}

\item Момент времени $\tau\in T_h$ фиксируется

\item Состояние $z$ выступает в качестве \alert{параметра}

\end{itemize}
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

% \begin{frame}{Применение параметрического \\ программирования в задачах синтеза}
%     \begin{itemize}\itemsep = 3mm
%         \item В результате преобразований привели задачу (\ref{3-2-1}) к виду:
%     \end{itemize}
%     \begin{block}{}
%         \begin{equation} \label{3-2-2}
%         \begin{aligned}
%             & \sum_{s \in T_h(\tau)}h(u_1(s) + u_2(s)) \to \min,\\
%             & \dot{x} = Ax + bu_1 - bu_2,   \\
%             &  x(\tau) = z, \ \ x(t_f) = 0, \\
%             & 0\le u_1(s)\le L, \ 0\le u_1(s)\le L, \  s\in T_h(\tau).
%         \end{aligned}
%     \end{equation}
% \end{block}
% \end{frame}

%-----------------------------------------------------------------------
% %-----------------------------------------------------------------------

% \begin{frame}{Применение параметрического программирования в задачах синтеза}
%     Запишем по формуле Коши терминальное состояние:
%     \begin{equation*}
%         x(t_f) = F(t_f, t_0)x_0 + \int_{t_0}^{t_f}F(t_f, \theta)b(u_1(\theta) - u_2(\theta))d\theta.
%     \end{equation*}
%     В силу дискретности управляющего воздействия, интеграл на промежутке $T = [t_0, t_f]$ представим в виде суммы интегралов на промежутках $[s,s+h],\ s \in T_h$.

%     Теперь терминальные ограничения:
%     \begin{equation*}
%         x(t_f) = F(t_f, t_0)x_0 +  \sum_{s \in T_h}\int_{s}^{s+h} F(t_f, \theta)b \ d\theta (u_1(s) - u_2(s)) = 0.
%     \end{equation*}

% \end{frame}

% %-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического \\ программирования в задачах синтеза}
    \begin{itemize}\itemsep = 3mm
        \item  Задача для позиции $(\alert{\tau,z})$ в функциональной форме (исключены состояния $x$, переменными оптимизации являются только управления $u$)
    \end{itemize}
    \begin{block}{Функциональная форма задачи оптимального управления}
        \begin{equation}
            \begin{aligned}
                & \sum_{s \in T_h(\tau)} h(u_1(s) + u_2(s)) \to \min\\
                & \sum_{s \in T_h(\tau)} d_h(s)(u_1(s) - u_2(s)) = G(\tau)z \\
                & 0 \le u_i(s) \le L, \ i = 1, 2, \ s \in T_h(\tau)\\
            \end{aligned}
        \end{equation}
    \end{block}

    \small $d_h(s) = \int_{s}^{s+h} F(t_f, \theta)b \ d\theta$

    \small $G(\tau) = - F(t_f, \tau)$
\end{frame}

%-----------------------------------------------------------------------

%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического \\ программирования в задачах синтеза}
    \begin{itemize}\itemsep = 3mm
        \item Соответствующая задача, как задача многопараметрического программирования (mp-LP):
    \end{itemize}
    \begin{block}{Задача многопараметрического программирования}
        \begin{equation}
            \begin{aligned}
                & {\bf 1}^T U \to \min\\
                & DU = G(\tau)z \\
                & 0 \le U \le L{\bf 1}\\
            \end{aligned}
        \end{equation}
    \end{block}

    \small $
    D = [d_h(\tau)\ -d_h(\tau)\ \ldots \ d_h(t_f-h)\ -d_h(t_f-h)]
    $
    \small $
    U = [u_1(\tau)\ u_2(\tau)\ \ldots \ u_1(t_f-h)\ u_2(t_f-h)]^T
    $

    \small ${\bf 1}$ --- вектор из единиц соответствующей размерности

\end{frame}


%--------
%-----------------------------------------------------------------------

\begin{frame}{Пример}
    \begin{itemize}\itemsep = 2mm
        \item В качестве примера синтеза рассмотрим задачу оптимизации колебательной системы второго порядка, критерием качества в которой является минимизация полного импульса управляющего воздействия:
    \end{itemize}

    \begin{block}{Задача оптимизации колебательной системы второго порядка}
        \begin{equation}
            \begin{aligned}
                & J(u) = \int_0^{t_f}|u(t)|dt \to \min\\
                & \dot{x_1} = x_2\\
                & \dot{x_2} = -x_1 + u
            \end{aligned}
        \end{equation}
    \end{block}
    \small с ограничениями $-10 \le x \le 10$ и $-1 \le u(t) \le 1,\ t = 0,1, \ldots$
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
\begin{frame}{Пример}

\centering

        \includegraphics[width=0.35\textwidth]{figure1.eps}
        \includegraphics[width=0.35\textwidth]{figure5.eps}
        \includegraphics[width=0.35\textwidth]{figure10.eps}
        \includegraphics[width=0.35\textwidth]{figure20.eps}
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
\begin{frame}{Пример}
    \includegraphics[width=0.48\textwidth]{graphics-42.eps}
    \includegraphics[width=0.48\textwidth]{x1x2.eps}
\end{frame}

%-----------------------------------------------------------------------
% % -----------------------------------------------------------------------
% \begin{frame}{Применение параметрического программирования в задаче синтеза оптимальной линейной системы}
%     \begin{block}{}
%         u0 =
%           linprog([ch', ch'],[],[],[dh,-dh],
%             g0,zeros(2*N,1),L*ones(2*N,1)),
%     \end{block}
% \begin{figure}[h!]
%     \centering
%     \begin{subfigure}[b]{0.4\linewidth}
%         \includegraphics[width=\linewidth]{primer2-u.eps}
%         \caption{Оптимальная программа}
%       \end{subfigure}
%     \begin{subfigure}[b]{0.4\linewidth}
%       \includegraphics[width=\linewidth]{picture2-x.eps}
%       \caption{Фазовый портрет оптимальной траектории}
%     \end{subfigure}
%     \label{picture-primer}
%   \end{figure}
% \newpage
% \end{frame}


%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

% \begin{frame}{Применение параметрического программирования в MPC}
%     \textbf{Матрицы:}

%         A = [ 1, 1; 0,  1];\\
%         B = [ 1; 0.5]; \\

%     \textbf{Задаем линейную модель с дискретным временем:}\\

%     sys = ss(A,B,[],[],1);
%     model = LTISystem(sys); \\

%     \textbf{Ограничения на управления и состояния:} \\
%     model.x.min = [-5; -5];
% model.x.max = [5; 5];
% model.y.min = [-10; -10];
% model.y.max = [10; 10];
% model.u.min = -1;
% model.u.max = 1;

% \textbf{Параметры критерия качества:}\\
% R = 1;
% model.u.penalty = QuadFunction(R);
% model.x.penalty = QuadFunction(eye(2));

% \textbf{Терминальные значения:}\\
% P = model.LQRPenalty;
% Tset = model.LQRSet;

% \textbf{Наконец, формулируем задачу MPC:}\\


% ctrl = MPCController(model,7);


% \end{frame}


%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Заключение}

\begin{itemize}
    \item Предложены пути решения, включающие в себя использоваение MPT, задачи синтеза оптимальной системы второго порядка
    \item Проведен анализ методов параметрического программирования
    \item Изучены основные результаты теории оптимального управления и подход к построению реализаций оптимальных обратных связей.
\end{itemize}

\end{frame}

%--------------------------------------------------------------------------

\end{document} 