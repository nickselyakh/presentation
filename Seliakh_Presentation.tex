\documentclass[notheorems]{beamer}
\usepackage[cp1251]{inputenc}
\usepackage{SlideStyle}
\usepackage{graphicx}
%\usepackage{subcaption}
\usepackage{amsmath}
%\usepackage{listings}
%\usepackage[ruled,vlined,linesnumbered]{algorithm2e}

\titlegraphic{\vspace*{-8cm}
    \parbox[c]{3cm}{\includegraphics[height=.7cm]{bsulogo}}
    \hspace*{1cm}%
    \parbox[c]{2cm}{\includegraphics[height=1.5cm]{FPMIlogo}}
    \hspace*{1cm}%
    \parbox[c]{3cm}{\includegraphics[height=.7cm]{MOUlogo}}
    \vspace*{4cm}
}

\title[Синтез оптимальных систем на основе mp-LP]{СИНТЕЗ ОПТИМАЛЬНЫХ СИСТЕМ И УПРАВЛЕНИЙ ПО ПРОГНОЗИРУЮЩЕЙ МОДЕЛИ НА ОСНОВЕ МЕТОДОВ ПАРАМЕТРИЧЕСКОГО ЛИНЕЙНОГО ПРОГРАММИРОВАНИЯ}


\author[Н. С. Селях]{Никита Е. Селях}

\institute[ФПМИ, БГУ]{Кафедра методов оптимального управления}


\date[\copyright 2020]{\footnotesize \structure{Научный руководитель: Н.М.Дмитрук}}

\begin{document}
\maketitle


\begin{frame}{Цели и задачи работы}
    
\begin{itemize}\itemsep = 3mm
\item Предложить методы синтеза оптимальных обратных связей в линейной задаче оптимального управления на основе идей параметрического программирования, по аналогии с подходами, использующимися в явных схемах управления по прогнозирующей модели.

\item Применить набор инструментов и функций на основе Matlab для параметрической оптимизации и вычислительной геометрии (Multi-Paramteric Toolbox).
\end{itemize}
    
\end{frame}

%-----------------------------------------------------------------------

\begin{frame}{Классический подход к построению \\ оптимальных обратных связей}
   
\begin{itemize}\itemsep = 3mm
\item     Классический подход к построению оптимальной обратной связи продемонстрируем на примере следующей задачи:


\end{itemize}
   
    \begin{block}{Задача оптимального управления}
        \begin{equation} \label{1problem}
            J(u) = \varphi(x(t_f))\to \min,
            \end{equation}
        \begin{equation} \label{2problem}
            \dot{x}=f(x,u,t),\ x(t_0)=x_0
             \end{equation}
        \begin{equation} \label{3problem}
              x(t)\in X\in\mathbb{R}^n
             \end{equation}
        \begin{equation} \label{4problem}
               u(t)\in U\in\mathbb{R}^r,\  t\in [t_0, t_f]
             \end{equation}
    \end{block}
\small $x = x(t)\in \R^n$ --- состояние

$u = u(t)\in \R^r$ --- управление

\end{frame}


%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Классический подход к построению \\ оптимальных обратных связей}

\begin{itemize}\itemsep = 2mm
\item    Погрузим задачу (\ref{1problem}) -- (\ref{4problem}) в семейство задач:
    \begin{block}{Семейство задач}
    \begin{equation} \label{5problem}
        \varphi(x(t_f))\to \min
        \end{equation}
    $$
        \dot{x}=f(x,u,t),\ x(\alert{\tau})=\alert{z}
        $$
    $$
          x(t)\in X, \ \ u(t)\in U,\  t\in [\alert{\tau}, t_f]
      $$
    \end{block}

 {\small $u^0(t|\tau,z),\ t\in T_\tau$, --- оптимальная программа (\ref{5problem}) 
 
 $X_\tau$ --- множество состояний $z$, для которых  (\ref{5problem}) имеет решение}

\item    \alert{Оптимальная обратная связь}
\begin{equation} \label{6problem}
    u^0(\tau,z) = u^0(t|\tau,z), \ z\in X_{\tau}, \tau\in T
     \end{equation}
     
\item Построение (\ref{6problem}) --- \alert{синтез} оптимальной системы управления

\end{itemize}

\end{frame}

%-----------------------------------------------------------------------
% -----------------------------------------------------------------------

\begin{frame}{Явный MPC}
    \begin{itemize}
        \item Основную идею явного MPC покажем на примере задачи стабилизации линейной дискретной стационарной системы, для которой формулируется прогнозирующая задачи оптимального управления следующего вида:
    \end{itemize}
    \begin{block}{Прогнозирующая задачи оптимального управления}
        \begin{equation} \label{yav-1}
            J(x) = \min_{u(\cdot | t)} \sum_{t}^{t+N-1} L(x(k(t), u(k(t))) + F(x(t+N)t)),
        \end{equation}
    \end{block}
\end{frame}

% -----------------------------------------------------------------------

\begin{frame}{Явный MPC}
    При условиях: \\
    \begin{block}{Условия}
        \begin{equation}
            \begin{aligned}
                & x(k+1 |\ t) = Ax(k\ |\ t) + Bu(k\ |\ t)\\
                & x(t\ |\ t) = x(t),\ \\
                & C_{x}x(k\ |\ t) \le d_x, \ t \le k \le t+N-1,\ \\
                & C_{u}u(k\ |\ t) \le d_u, \ C_{x}x(t+N\ |\ t) = d_f,\ \\
                & C_f x(t + N |\ t) \le d_f.\ \\
            \end{aligned}
        \end{equation}
    \end{block}
        $ L(x, u) = x^TQx + u^TRu $ --- квадратичная функция стоимости
        $ F(x) = x^TQx,\ Q,R > 0 $ --- терминальная стоимость \\


 $C_x, C_u, C_f, d_x, d_u, d_f$ задают ограничения на траекторию, управления и терминальное состояние.

\end{frame}

%-----------------------------------------------------------------------
% -----------------------------------------------------------------------

\begin{frame}{Явный MPC}
    \begin{block}{}
    \begin{equation} \label{yav-5}
        J(x) = \min_z \frac{1}{2}z^THz + \frac{1}{2}x^T\tilde{Y}x,
    \end{equation}
\end{block}
       \small при условиях
       $Gz \le W + sx,$
       где $\tilde{Y} = Y - FH^{-1}F^T, \ S := E + GH^{-1}F^T$.
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Многопараметрическое \\ программирование}
    \begin{itemize}\itemsep = 2mm
        \item Рассмотрим многопараметрическую задачу линейного программирования (mp-LP)
    \end{itemize}
    \begin{block}{Многопараметрическая задача линейного программирования}
        \begin{equation}\label{1multy}
            \begin{split}
                & J^0(x) = \min_z J(z,x) = c'z,\\
                % \st 
                 & Gz \leq W + Sx,
            \end{split}
        \end{equation}
    \end{block}
    \small $z \in \mathbb{R}^s$ --- переменные оптимизации, $x \in \mathbb{R}^{n}$ --- вектор параметров, $J(z, x) \in \mathbb{R}$ --- целевая функция и $G \in \mathbb{R}^{m \times s},\ c \in \mathbb{R}^{s},\ W \in \mathbb{R}^{m}$, и $S \in \mathbb{R}^{m \times n}$,\ 
$K \triangleq \{ x \in \mathbb{R}^{n} : Tx \leq Z \}$--- многогранное множество параметров, $K \subset R^{n}$\\
\begin{itemize}\itemsep = 2mm
    \item $\alert{K^*} \subseteq K$ --- множество параметров $x \in K$, при которых задача (\ref{1multy}) допустима.
\end{itemize}
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Многопараметрическое \\ программирование}
    \begin{itemize}
        \item Cвойства, которыми обладает решение в задаче многопараметрического линейного программирования
    \end{itemize}
    \begin{theorem}\label{8theorem}
        Функция $J^0(x)$, $x\in K^*$, является выпуклой и кусочно-аффинной на $K^*$.
    
        Если для каждого $x\in K^*$ оптимальное решение $z^0 (x)$ единственно, то функция $z^0(x)$, $x\in K^*$, является непрерывной и кусочно-аффинной. В противном случае (в случае неединственного решения) всегда можно определить непрерывную и кусочно-аффинную функцию решения $z^0 (x) \in Z^0 (x)$, $x\in K^*$.
    \end{theorem}
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического \\ программирования в задачах синтеза}

\begin{itemize}\itemsep = 3mm
\item      Рассмотрим задачу оптимального управления линейной системой со скалярным управлением
    \begin{equation}
        \dot{x} = Ax + bu
    \end{equation}
\item  c критерием качества
\begin{equation}
    J(u) = \int_0^{t_f}|u(t)|dt \to \min
\end{equation}
\item при условиях
\begin{equation}
    x(0) = x_0,\ x(t_f) = 0, \ \ |u(t)|\le L
\end{equation}
{\small $L>0$ --- амплитуда управления}

\end{itemize}
\end{frame}



%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического \\ программирования в задачах синтеза}

\begin{itemize}\itemsep = 3mm
\item 
    Семейство, в которое погружается задача для определения обратной связи, имеет вид
    \begin{block}{}
        \begin{equation}\label{3-2-1}
            J(u) = \int_{\tau}^{t_f}|u(t)|dt \to \min
        \end{equation}
        $$
            \dot{x} = Ax + bu, \ x(\tau) = \alert{z}
        $$
        $$
            x(t_f) = 0, \ \ |u(t)|\le L, t\in [\tau, t_f]
        $$
    \end{block}
        
\item Момент времени $\tau\in T_h$ фиксируется 

\item Состояние $z$ выступает в качестве \alert{параметра}

\end{itemize}
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

% \begin{frame}{Применение параметрического \\ программирования в задачах синтеза}
%     \begin{itemize}\itemsep = 3mm
%         \item В результате преобразований привели задачу (\ref{3-2-1}) к виду:
%     \end{itemize}
%     \begin{block}{}
%         \begin{equation} \label{3-2-2}
%         \begin{aligned}
%             & \sum_{s \in T_h(\tau)}h(u_1(s) + u_2(s)) \to \min,\\
%             & \dot{x} = Ax + bu_1 - bu_2,   \\
%             &  x(\tau) = z, \ \ x(t_f) = 0, \\
%             & 0\le u_1(s)\le L, \ 0\le u_1(s)\le L, \  s\in T_h(\tau).
%         \end{aligned}
%     \end{equation}
% \end{block}
% \end{frame}

%-----------------------------------------------------------------------
% %-----------------------------------------------------------------------

% \begin{frame}{Применение параметрического программирования в задачах синтеза}
%     Запишем по формуле Коши терминальное состояние:
%     \begin{equation*}
%         x(t_f) = F(t_f, t_0)x_0 + \int_{t_0}^{t_f}F(t_f, \theta)b(u_1(\theta) - u_2(\theta))d\theta.
%     \end{equation*}
%     В силу дискретности управляющего воздействия, интеграл на промежутке $T = [t_0, t_f]$ представим в виде суммы интегралов на промежутках $[s,s+h],\ s \in T_h$.
    
%     Теперь терминальные ограничения:
%     \begin{equation*}
%         x(t_f) = F(t_f, t_0)x_0 +  \sum_{s \in T_h}\int_{s}^{s+h} F(t_f, \theta)b \ d\theta (u_1(s) - u_2(s)) = 0.
%     \end{equation*}
    
% \end{frame}

% %-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического \\ программирования в задачах синтеза}
    \begin{itemize}\itemsep = 3mm
        \item  Задача для позиции $(\alert{\tau,z})$:
    \end{itemize}
    \begin{block}{Функциональная форма задачи оптимального управления}
        \begin{equation}
            \begin{aligned}
                & \sum_{s \in T_h(\tau)} h(u_1(s) + u_2(s)) \to \min,\\
                & \sum_{s \in T_h(\tau)} d_h(s)(u_1(s) - u_2(s)) = G(\tau)z, \\
                & 0 \le u_i(s) \le L, \ i = 1, 2, \ s \in T_h(\tau).\\
            \end{aligned}
        \end{equation}
    \end{block}

    \small $d_h(s) = \int_{s}^{s+h} F(t_f, \theta)b \ d\theta$

    \small $G(t_0) = - F(t_f, t_0)$

    \small $G(\tau) = - F(t_f, \tau)$
\end{frame}

%-----------------------------------------------------------------------

%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического \\ программирования в задачах синтеза}
    \begin{itemize}\itemsep = 3mm
        \item Соответствующая задача, как задача многопараметрического программирования (mp-LP):
    \end{itemize}
    \begin{block}{Задача многопараметрического программирования}
        \begin{equation}
            \begin{aligned}
                & {\bf 1}^T U \to \min,\\
                & DU = G(\tau)z, \\
                & 0 \le U \le L{\bf 1},\\
            \end{aligned}
        \end{equation}
    \end{block}

    \small $
    D = [d_h(\tau)\ -d_h(\tau)\ \ldots \ d_h(t_f-h)\ -d_h(t_f-h)],
    $
    \small $
    U = [u_1(\tau)\ u_2(\tau)\ \ldots \ u_1(t_f-h)\ u_2(t_f-h)]^T,
    $

    \small ${\bf 1}$ --- вектор из единиц соответствующей размерности.
    
\end{frame}


%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Multi-Parametric Toolbox}
    \begin{itemize}
        \item Multi-Parametric Toolbox (или \textbf{MPT}) --- это набор инструментов и функций на основе Matlab с открытым исходным кодом для параметрической оптимизации и вычислительной геометрии.
        Инструментарий предлагает широкий спектр алгоритмов, скомпилированных в удобном и доступном для пользователя формате.
        Полученные в результате законы оптимального управления могут быть встроены в приложения в виде кода на C или развернуты на целевых платформах с использованием Real Time Workshop.
    \end{itemize}
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Multi-Parametric Toolbox}
    \textbf{Содержание} MPT для задач управления:
    \begin{itemize}\itemsep = 2mm
        \item Моделирование динамических систем.
        \item Построение MPC-регуляторов для линейных систем на основе явных схем (на основе многопараметрического программирования).
        \item Анализ обратной связи, полученной МРС-регулятором.
        \item Развертывание регуляторов MPC на аппаратном уровне.
    \end{itemize}
\end{frame}

%--------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического \\ программирования в задаче синтеза оптимальной линейной системы}
    \begin{itemize}\itemsep = 2mm
        \item В качестве примера синтеза рассмотрим задачу оптимизации колебательной системы второго порядка, критерием качества в которой является минимизация полного импульса управляющего воздействия:
    \end{itemize}

    \begin{block}{Задача оптимизации колебательной системы второго порядка}
        \begin{equation}
            \begin{aligned}
                & J(u) = \int_0^{t_f}|u(t)|dt \to \min\\
                & \dot{x_1} = x_2\\
                & \dot{x_2} = -x_1 + u
            \end{aligned}
        \end{equation}
    \end{block}
    \small с ограничениями $-10 \le x \le 10$ и $-1 \le u(t) \le 1,\ t = 0,1, \ldots$
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
\begin{frame}{Применение параметрического \\ программирования в задаче синтеза оптимальной линейной системы}
        \includegraphics[width=0.35\textwidth]{figure1.eps}
        \includegraphics[width=0.35\textwidth]{figure5.eps}
        \includegraphics[width=0.35\textwidth]{figure10.eps}
        \includegraphics[width=0.35\textwidth]{figure20.eps}
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------
\begin{frame}{Применение параметрического \\ программирования в задаче синтеза оптимальной линейной системы}
    \includegraphics[width=0.48\textwidth]{graphics-42.eps}
    \includegraphics[width=0.48\textwidth]{x1x2.eps}
\end{frame}

%-----------------------------------------------------------------------
% % -----------------------------------------------------------------------
% \begin{frame}{Применение параметрического программирования в задаче синтеза оптимальной линейной системы}
%     \begin{block}{}
%         u0 =
%           linprog([ch', ch'],[],[],[dh,-dh],
%             g0,zeros(2*N,1),L*ones(2*N,1)),
%     \end{block}
% \begin{figure}[h!]
%     \centering
%     \begin{subfigure}[b]{0.4\linewidth}
%         \includegraphics[width=\linewidth]{primer2-u.eps}
%         \caption{Оптимальная программа}
%       \end{subfigure}
%     \begin{subfigure}[b]{0.4\linewidth}
%       \includegraphics[width=\linewidth]{picture2-x.eps}
%       \caption{Фазовый портрет оптимальной траектории}
%     \end{subfigure}
%     \label{picture-primer}
%   \end{figure}
% \newpage
% \end{frame}


%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического \\ программирования в MPC}
    \begin{itemize}
        \item 
        Рассмотрим дискретную линейную систему управления:
    \end{itemize}
    \begin{block}{Дискретная линейная система управления}
        \begin{equation}\label{sys1}
            x (t + 1) = \begin{bmatrix}
                1 & 1\\
                0 & 1
            \end{bmatrix}x(t) + \begin{bmatrix}
                1\\
                0.5
            \end{bmatrix}u(t),
        \end{equation}
    \end{block}
        \small c ограничениями $-5 \le x(t) \le 5$ и $-1 \le u(t) \le 1$, $t= 0,1, \ldots$.
\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

% \begin{frame}{Применение параметрического программирования в MPC}
%     \textbf{Матрицы:}

%         A = [ 1, 1; 0,  1];\\
%         B = [ 1; 0.5]; \\

%     \textbf{Задаем линейную модель с дискретным временем:}\\

%     sys = ss(A,B,[],[],1);
%     model = LTISystem(sys); \\

%     \textbf{Ограничения на управления и состояния:} \\
%     model.x.min = [-5; -5];
% model.x.max = [5; 5];
% model.y.min = [-10; -10];
% model.y.max = [10; 10];
% model.u.min = -1;
% model.u.max = 1;

% \textbf{Параметры критерия качества:}\\
% R = 1;
% model.u.penalty = QuadFunction(R);
% model.x.penalty = QuadFunction(eye(2));

% \textbf{Терминальные значения:}\\
% P = model.LQRPenalty;
% Tset = model.LQRSet;

% \textbf{Наконец, формулируем задачу MPC:}\\


% ctrl = MPCController(model,7);


% \end{frame}

%------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического \\ программирования в MPC}
    \begin{itemize}
        \item Результаты реализации для $x = (3, 1)$
    \end{itemize}

          \includegraphics[width=0.48\linewidth]{pctr-u.eps}
          \includegraphics[width=0.48\linewidth]{pctr-x.eps}
\end{frame}


%-----------------------------------------------------------------------

\begin{frame}{Применение параметрического \\ программирования в MPC}
    \begin{itemize}
        \item Критические области и траектории замкнутой системы  для нескольких начальных значений
    \end{itemize}
        \includegraphics[width=0.7\linewidth]{pctr-expl.eps}

\end{frame}

%-----------------------------------------------------------------------
%-----------------------------------------------------------------------

\begin{frame}{Заключение}

\centering \large \emph{Спасибо за внимание!}

\end{frame}

%--------------------------------------------------------------------------

\end{document} 